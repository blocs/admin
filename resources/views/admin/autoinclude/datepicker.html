<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css" integrity="sha512-MQXduO8IQnJVq1qmySpN87QQkiR1bZHtorbJBD0tzy7/0U9+YIC93QWHeGTEoojMVHWWNkoCp8V6OzVSYrX0oQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js" integrity="sha512-K/oyQtMXpxI4+K0W7H25UopjM8pzq0yrVdFdG21Fh5dBe91I40pDd9A4lzNlHPHBIP2cwZuoxaUSX0GJSObvGA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/ja.min.js" integrity="sha512-XamS5TTeqwEqePo/YxW3AFGwvEcQzN520Om7b1eB/LYHt6tLgXZeutZPPF8D0sIo7YndJEpCEhKwvf62U780Dw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript">
    new MutationObserver((mutations) => {
        document.querySelectorAll(".ai-datepicker").forEach(function(item, i) {
            flatpickr(item, {
                disableMobile: true,
                locale: "ja",
                allowInput: true,
                onOpen: function() {
                    if (item.focus) {
                        item.focus();
                    }
                    var group = item.closest('.input-group');
                    if (group) {
                        group.classList.add('is-focused');
                    }
                },
                onValueUpdate: function(selectedDates, dateStr) {
                    var group = item.closest('.input-group');
                    if (group) {
                        if (dateStr) {
                            group.classList.add('is-filled');
                        } else {
                            group.classList.remove('is-filled');
                        }
                    }
                    item.dispatchEvent(new Event('input', { bubbles: true }));
                },
                onClose: function() {
                    var group = item.closest('.input-group');
                    if (group) {
                        if (item.value) {
                            group.classList.add('is-filled');
                        }
                        group.classList.remove('is-focused');
                    }
                }
            });
            item.classList.remove("ai-datepicker");
        });
    }).observe(document, {
        childList: true,
        subtree: true
    });
</script>
