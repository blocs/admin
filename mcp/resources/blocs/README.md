# Laravel用テンプレートエンジン「BLOCS」の概要
BLOCSは、Laravelで利用できるテンプレートエンジンです。テンプレートエンジンとは、コントローラーで設定された変数とテンプレートファイルを組み合わせて、HTMLを自動的に生成する仕組みのことです。これにより、表示部分のコードを効率的に管理でき、開発の生産性が向上します。

## BLOCS（blocs/blocs）の特徴
### データ属性（`data-*` 属性）を活用した動的HTML生成
BLOCSは、HTMLの **data-\*** 属性を使って、条件分岐や他のテンプレートの読み込みなどを実現します。これにより、HTMLの表示を柔軟にコントロールできます。テンプレートでデータ属性を書く方法には、タグ記法とコメント記法の2種類があります。

### フォーム入力のバリデーション条件の指定
入力画面から送信されたデータ（入力値）に対して行う **バリデーション（入力チェック）** を、テンプレート側で指定できます。たとえば、「必須入力」や「文字数制限」などの条件を、コントローラーではなくテンプレートで指定できる仕組みです。

### Bladeとのハイブリッド利用が可能
Laravel標準のテンプレートエンジン「Blade」と併用できます。つまり、必要な部分だけBLOCSを使うといった柔軟な開発スタイルが可能です。

## テンプレートファイルの拡張子
BLOCSのテンプレートは、そのままHTMLとしてブラウザで確認できるように、拡張子を.htmlにしています。

|テンプレートエンジン|拡張子|
|:-----------|:-----------|
|Blade|*.blade.php|
|BLOCS|*.blocs.html|

# タグ記法
**タグ記法** とは、HTMLタグにデータ属性（`data-*` 属性）を追加して、HTMLを動的に制御する記述方法です。多くの場合、HTMLの開始タグから終了タグまでの範囲に対して、表示・非表示や繰り返し表示などの処理を行います。
そこで、開始タグにデータ属性を付けることで、そのタグ全体（開始〜終了）を対象に処理できるようにしました。
BLOCSでは、開始タグにデータ属性を追加することで、HTMLの構造を保ちながら動的なコンテンツを生成します。

## サンプルコード
BLOCSを使うと、以下のようにシンプルな記述で動的なHTMLを生成できます。テンプレートで指定したデータ属性により、HTMLの構造を崩すことなく、柔軟な制御が可能です。
```html
<div class="error" data-exist=$errorMessage data-val=$errorMessage>
    errorMessage
</div>
```

# コメント記法
**コメント記法** とは、HTMLのコメント内にデータ属性（ `data-attribute` など）を記述する方法です。主に、他のテンプレートを読み込む際や、HTMLタグに動的に属性を追加する場面で使用されます。この記法を使うことで、HTMLの構造を壊すことなく、ブラウザ上でそのまま表示・操作が可能になります。

## サンプルコード
コメント記法で記述されたデータ属性 `data-attribute` は、直後にあるHTMLタグの属性値を動的に置換します。以下の例では、$errorが存在しない（＝エラーが発生していない）場合、divタグのclass属性が "success" に置き換えられます。また、タグ記法とコメント記法は併用可能です。
```html
<!-- data-attribute="class" data-val="success" data-none=$error -->
<div class="error" data-val=$message>Message</div>
```

実際のテンプレートでは、コメント記法とタグ記法を組み合わせて、繰り返し処理や変数の代入を行います。
```html
<tr data-loop=$books>
    <td><!-- $book->id --></td>
    <td><!-- $book->title --></td>
    ...
    <td>
        <span data-loop=$book->tags data-assign=$bookTag>
            <!-- $bookTag->name -->
            <br>
        </span>
    </td>
    ...
</tr>
```

# データ属性一覧
ご利用いただけるデータ属性は、以下の一覧に記載されているものに限られます。記載されていないデータ属性は使用できません。また、新たに独自のデータ属性を作成することもできません。

## 変数を操作する
テンプレート内では、コントローラーから渡された変数を表示したり、整形したり、タグの属性に代入することができます。単に表示するだけでなく、柔軟な制御が可能です。以下は、変数を操作するための主なデータ属性です。

|データ属性|役割|
|:-----------|:-----------|
|data-val|変数の値を表示します。|
|data-attribute|変数の値を使って、HTMLタグの属性を動的に変更します。|
|data-assign|変数に値を代入します。ループ処理などで一時的な変数として使用できます。|
|data-prefix|表示する変数の先頭に文字列を追加します。|
|data-postfix|表示する変数の末尾に文字列を追加します。|
|data-convert|変数の表示形式を整形します（元の値は変更されません）。|
|data-lang|多言語対応のため、言語ごとの表示を切り替えます。|

## 変数でHTMLタグを動的に制御する
テンプレートでは、コントローラーから渡された変数を使って、HTMLの表示を動的に制御できます。
主な制御方法には、条件分岐と繰り返し処理があります。

- 条件分岐では、変数の値の有無や条件に応じて、タグの表示・非表示を切り替えます。
- 繰り返し処理では、配列の要素数に応じて、同じ構造を複数回表示します。

これらの制御は、プログラミング言語における「if文」や「for文」に相当します。これらの属性を活用することで、テンプレートの表示内容を柔軟に制御でき、より動的なページ作成が可能になります。

|データ属性|役割|
|:-----------|:-----------|
|data-exist|変数に値がセットされている場合に処理を実行します。|
|data-none|変数に値がセットされていない場合に処理を実行します。|
|data-if|指定した条件を満たす場合に処理を実行します。|
|data-unless|指定した条件を満たさない場合に処理を実行します。|
|data-loop|配列の要素数に応じて、繰り返し処理を行います。|

## フォーム入力にバリデーション条件を指定する
入力フォームから送信されたデータ（入力値）に対してバリデーション条件を設定することができます。これにより、必須入力のチェックや「ひらがなのみ」などの入力制限を行うことが可能です。
さらに、フィルター機能を使えば、入力値の整形（例：空白の除去、ひらがなへの変換など）も行えます。フィルターはバリデーションの前に適用され、元の変数の値を変更します。これらの属性を活用することで、ユーザーの入力ミスを防ぎ、より正確なデータを取得することができます。

|データ属性|役割|
|:-----------|:-----------|
|data-form, data-validate, data-lang|入力値に対してバリデーション条件を指定します。例：必須入力、文字種の制限など。|
|data-filter|入力値をバリデーション前に整形します。例：空白の除去、ひらがなへの変換など。元の変数の値が変更されます。|

## テンプレートを再利用する
テンプレートの再利用により、共通のヘッダーやフッターなどを一元管理でき、複数ページで同じ構成要素を効率よく使い回すことが可能になります。これにより、保守性や開発効率が大幅に向上します。

|データ属性|役割|
|:-----------|:-----------|
|data-include|他のテンプレートや、data-bloc で定義されたテンプレートを読み込みます。|
|data-bloc|他のテンプレートから再利用できるように、テンプレート部品（ブロック）を定義します。|

# 省略記法（簡略化された記述方法）
一部のデータ属性は、**省略記法** を使って、より簡潔に記述することができます。これにより、コードが短くなり、読みやすさが向上します。省略記法を使うことで、テンプレートの記述がよりシンプルになり、可読性が向上します。必要に応じて、通常の記法と使い分けると便利です。

|データ属性|省略記法|解説|
|:-----------|:-----------|:-----------|
|data-val=$name|$name|変数 $name の値をそのまま表示します。|
|data-attribute="href" data-val=$url|:href=$url|href 属性に $url の値を設定します。|
|data-form="name" data-validate="required"|!name="required"|name フィールドに「必須入力」のバリデーションを設定します。|

# Auto Include 機能
## 使いやすい入力インターフェースの実装
入力フォームに **ai-\*** クラス（Auto Include クラス）を指定することで、フォームの機能を自動的に拡張できます。この仕組みを利用することで、ユーザーにとって使いやすい入力インターフェースを簡単に実装でき、テンプレートの記述もシンプルになります。

### 日付選択フォームのサンプルコード
以下のように、class 属性に `ai-datepicker` を指定すると、カレンダー付きの日付入力フォームが自動的に読み込まれます
```html
<input type="text" id="date" name="date" class="form-control ai-datepicker" />
```

## テンプレートの自動読み込み
`data-include` で指定したブロック名に対応するテンプレートファイルを自動で読み込みます。

### ボタンの表示方法
テンプレート内で Auto Include 機能を使うことで、ボタンを簡単に表示できます。さらに、`data-include` 属性に **引数（変数）** を追加することで、ボタンのリンク先やデザイン、アイコン、ラベルなどを自由にカスタマイズできます。
```html
<!--
    data-include="button_href"
    $buttonHref=route("admin.user.create")
    $buttonClass="btn btn-primary"
    $buttonIcon="fa-solid fa-plus"
    $buttonLabel="新規作成"
-->
```

### 確認用モーダルの表示方法
テンプレート内で Auto Include 機能を使うことで、データ登録前などに確認用のモーダルを簡単に表示できます。また、`data-include` 属性に **引数（変数）** を追加することで、モーダルの表示内容を自由にカスタマイズできます。他にも、タイトルやメッセージ、ボタンの色などを変更する方法もあります。
```html
<!--
    data-include="modal_update"
    $buttonIcon="fa-solid fa-file"
    $buttonLabel="ボタンのラベル"
-->
```

### グラフの表示方法
テンプレート内で Auto Include 機能 を使うと、グラフを簡単に表示できます。さらに、`data-include` 属性に **引数（変数）** を指定することで、グラフの色や凡例（ラベル）などを自由にカスタマイズできます。
```html
<!--
    data-include="chartjs_1line"
    $graphId="graphUser"
    $chartjsColor="Blues3"
    $graphLegendLine1="登録"
-->

<canvas :id=$graphId class="chart-canvas" height="300"></canvas>
```

# QA
## タグ記法とコメント記法を併用できますか？
同じ内容をタグ記法とコメント記法で同時に記述することはできません。特に `data-val` を使って、タグの表示内容とコメントの両方を制御しようとする記述は **誤り** です。以下のような記述は避けてください。タグの表示を制御したい時は、`data-exist`、`data-none`、`data-if`、`data-unless` を使います。
```html
<div data-val=$name><!-- data-val=$name --></div>
```

## jQueryを使いたい。
テンプレート内で以下のように記述することで、Auto Include により jQuery が読み込まれ、使用可能になります。
```html
<!-- data-include="jquery" -->
```

## JavaScriptの読み込むを、HTMLの一番最後にしたい。
JavaScriptをページの最後（`</body>` の直前）で読み込みたい場合は、以下のように `data-bloc="script"` を指定します。
```html
<script data-bloc="script"></script>
```
