---
description: 1.3 自動生成された管理画面から不要な機能を無効化する
globs: **/*.php, **/*.blocs.html, **/*.html
alwaysApply: false
---
# 1.3 自動生成された管理画面から不要な機能を無効化する
## ファイル操作機能を無効にする方法
定義ファイル内で入力タイプに `upload` が含まれていない場合、ファイル操作機能は不要ですので無効化します。

### ルーティングの修正
ファイル操作機能を完全に無効にするには、`routes/web.php` から以下のルーティング定義を削除してください。
- upload
- download
- thumbnail

## 一括削除機能を無効にする方法
一覧画面で複数行を選択して削除できる **一括削除機能** を無効にするには、以下の対応が必要です。

### ルーティングの修正
`routes/web.php` から、以下のルーティング定義を削除してください。
- select

### テンプレートの修正
一覧画面のテンプレートファイル `index.blocs.html` を編集し、`$selectable` によって制御されている以下のような出力部分をすべて削除します。
```html
<!-- data-bloc="buttonBottomLeft" -->
    <!--
        data-include="modal_destroy"
        $buttonClass="btn btn-danger"
        $modalAction=route(prefix().".select")
        data-if="$isLoop && !empty($selectable)"
    -->
<!-- data-endbloc -->
```

## ステータス切り替え機能を無効にする方法
定義ファイルのフォーム項目に `disabled_at` が含まれていない場合、ステータスの切り替え機能は不要ですので無効化します。

### ルーティングの修正
`routes/web.php` から、以下のルーティング定義を削除します。
- toggle

### テンプレートの修正
一覧画面のテンプレートファイル `index.blocs.html` を編集し、以下のような `modalActivate` および `modalInactivate` に関連する処理をすべて削除してください。
```html
<a class="me-3" data-bs-toggle="modal" data-bs-target="#modalActivate" :data-modalaction=route(prefix().".toggle", ["id" => $user->id]) data-exist=$user->disabled_at>
    <i class="fa-solid fa-check" data-bs-toggle="tooltip" :data-bs-original-title=__("template:admin_user_valid_title")></i>
</a>
<a class="me-3" data-bs-toggle="modal" data-bs-target="#modalInactivate" :data-modalaction=route(prefix().".toggle", ["id" => $user->id]) data-none=$user->disabled_at>
    <i class="fa-solid fa-ban" data-bs-toggle="tooltip" :data-bs-original-title=__("template:admin_user_invalid_title")></i>
</a>

<!-- data-bloc="modalFooterRight" -->
    <!--
        data-include="buttonSuccessModal"
        $buttonModalLabel=__("template:admin_user_button_valid")
    -->
<!-- data-endbloc -->
<!--
    data-include="modal"
    $modalName="modalActivate"
    $modalTitle=__("template:admin_user_valid_title")
    $modalMessage=__("template:admin_user_valid_message")
    data-exist=$isLoop
-->

<!-- data-bloc="modalFooterRight" -->
    <!--
        data-include="buttonWarningModal"
        $buttonModalIcon="fa-solid fa-ban"
        $buttonModalLabel=__("template:admin_user_button_invalid")
    -->
<!-- data-endbloc -->
<!--
    data-include="modal"
    $modalName="modalInactivate"
    $modalTitle=__("template:admin_user_invalid_title")
    $modalMessage=__("template:admin_user_invalid_message")
    data-exist=$isLoop
-->
```

### モデルの修正
自動生成されたモデルファイルから、以下のアクセサ・ミューテータを削除してください。
```php
public function getDisabledAtAttribute($value)
{
    return isset($value) ? 1 : 0;
}

public function setDisabledAtAttribute($value)
{
    $this->attributes['disabled_at'] = empty($value) ? null : now();
}
```
