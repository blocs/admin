---
description: Laravel Admin Packageの概要
globs: **/*.php
alwaysApply: false
---
# 概要
**Laravel Admin Package（blocs/admin）** は、Laravelで管理画面を効率的に構築できる開発支援ツールです。LaravelはMVC（Model-View-Controller）アーキテクチャを採用したPHPフレームワークであり、本パッケージはその構造に沿って、管理画面の開発を簡素化・標準化します。

## Laravel Admin Package（blocs/admin） の特徴
- **開発支援ツール（developツール）** を使って、定義ファイルから画面を自動生成
- 管理画面の処理フロー（一覧・新規作成・編集など）を **ベースコントローラー** により定型化
- 入力項目の追加や画面のカスタマイズは、テンプレート編集のみで対応可能

このパッケージを活用することで、Laravelでの管理画面開発が高速・効率的・柔軟に行えます。さらに、開発支援ツールとテンプレートの組み合わせにより、保守性の高い管理機能の追加が可能です。

## MVC構成の利用方法
- Model
  - Laravel標準の Eloquent ORM をそのまま使用
- View
  - Laravel標準の Bladeテンプレート に加え、**BLOCS** テンプレート を併用
- Controller
  - 管理画面用の基本機能を備えた **ベースコントローラー** を継承
  - 必要な機能のみをカスタマイズすることで、効率的な開発が可能

## 導入時に含まれる標準の管理画面
以下の画面は、パッケージに標準で含まれており、インストール後すぐに利用できます。
- ホーム画面
- ログイン画面
- ユーザー管理画面
- プロフィール設定画面

## 管理画面の追加方法
新たに管理画面を追加する場合は、以下の手順で作業を進めます。
1. 開発支援ツールによる自動生成
   - 必要なファイルや初期設定を、開発支援ツールで自動生成します。
2. 自動生成された管理画面のカスタマイズ
   - 自動生成されたテンプレートを、要件に合わせて編集します。
   - 画面の表示内容や動作を調整するために、コントローラーに必要な処理を実装します。
3. アクセス権限とサイドメニューを設定
   - アクセス権限は `config/role.php` にて設定します。
   - サイドメニューは `config/menu.php` にて設定し、管理画面へのリンクを追加します。

# 1. 開発支援ツールによる自動生成
開発支援ツール **developツール** は、JSON形式の定義ファイルをもとに、Laravelの管理画面を自動生成するツールです。このツールを使うことで、コントローラー・ビュー・ルーティング などを一括で生成でき、管理機能の追加が非常に簡単になります。

## 1.1 定義ファイルの作成
管理画面の構成情報は、JSON形式の定義ファイルとして記述します。作成した定義ファイルは、`docs/develop/` に保存してください（`docs/develop/sample.json` など）。

## 1.2 管理画面の自動生成
以下の Artisan コマンドを実行すると、定義ファイルに基づいて管理画面が自動生成されます。
```sh
php artisan blocs:develop docs/develop/sample.json
```

このコマンドにより、以下の要素が一括で生成されます。
- コントローラー
- ビュー
- ルーティング

さらに、マイグレーションも自動で実行されるため、`php artisan migrate` を別途実行する必要はありません。

### コマンド実行時に行われる処理
定義ファイルに従って、以下の処理が自動的に行われます。
- ベースコントローラーを継承したコントローラーの生成
- `routes/web.php` へのルーティング情報の追加
- `config/menu.php` へのメニュー情報の追加
- モデルの生成
- データベース定義ファイルの生成
- マイグレーションの実行（`php artisan migrate`）
- テンプレートの生成

### 自動生成後の管理画面に含まれる基本機能（ベースコントローラー）
|機能|メソッド（ルート名）|処理内容|テンプレート|
|:-----------|:-----------|:-----------|:-----------|
|一覧表示|index|登録されているデータの一覧を表示|index.blocs.html|
|一覧表示|search|条件を指定してデータを検索し、結果の一覧を表示|index.blocs.html|
|新規作成|create|新しいデータを登録するための入力画面を表示|create.blocs.html|
|新規作成|store|入力された新しいデータを保存|なし|
|編集|edit|編既存のデータを編集するための画面を表示|edit.blocs.html|
|編集|update|編集された内容でデータを更新|なし|
|削除|show|データを削除する前に確認画面を表示|show.blocs.html|
|削除|destroy|指定されたデータを削除|なし|
|ファイル操作|upload|ファイルをシステムにアップロード|なし|
|ファイル操作|download|システムからファイルをダウンロード|なし|
|ファイル操作|thumbnail|アップロードされた画像ファイルのサムネイルを表示|なし|
|一括削除|select|一覧画面で複数のデータをまとめて選択して削除|なし|
|ステータス切り替え|toggle|データの状態（有効／無効）を切り替え|なし|

## 1.3 自動生成された管理画面から不要な機能を無効化する
管理画面を自動生成した後、不要な基本機能を無効化または削除することで、画面構成をよりシンプルに保つことができます。これにより、ユーザーにとって使いやすく、目的に特化した管理画面を実現できます。

# 2. 自動生成された管理画面のカスタマイズ
入力項目の追加や画面のカスタマイズは、テンプレート編集のみで対応可能
管理画面の各コントローラーは、共通機能を備えた **ベースコントローラー** を継承して作成します。これにより、必要な機能だけを個別に追加するだけで済み、開発効率が向上します。共通処理の重複を避け、保守性の高いコードを実現できます。

## 2.1 共通機能のカスタマイズ
管理画面で共通で使える、ヘッダー、フッター、サイドメニュー、ナビゲーションなどのテンプレートがあります。管理画面では、ヘッダー・フッター・サイドメニュー・ナビゲーション など、複数の画面で共通して使用されるテンプレートが用意されています。これらのテンプレートは、プロジェクトのデザインや機能要件に合わせて 自由にカスタマイズ することができます。
- ロゴやタイトルの変更
- メニュー項目の追加・削除
- 表示条件の切り替え（ユーザー権限による表示制御 など）

## 2.2 一覧表示機能のカスタマイズ
一覧画面では、以下のような 基本機能 が提供されています。
- ページネーション（複数ページに分割して表示）
- 検索機能（キーワードや条件で絞り込み）
- ソート機能（項目ごとの昇順・降順の並び替え）

これらの機能は、テンプレートやコントローラーを編集することで、表示項目や検索条件、並び順などを柔軟にカスタマイズできます。

## 2.3 新規作成・編集機能のカスタマイズ
新規作成および編集機能は、管理画面上でデータを安全かつ正確に登録・更新するための処理です。ユーザーが必要な情報を入力し、既存データの修正も行えるように設計されています。

## 2.4 削除機能のカスタマイズ
削除機能は、管理画面上で不要なデータを安全に削除するための処理です。誤操作を防ぐための確認ステップや、削除後の影響を最小限に抑える工夫が求められます。

## 2.5 ログイン画面のカスタマイズ
ログイン機能は、管理画面へのアクセスを制限し、認証されたユーザーのみが利用できるようにするための処理です。セキュリティを確保するため、ユーザー認証やパスワード管理などが含まれます。

# 3. アクセス権限とサイドメニューの設定
## 3.1 アクセス権限の設定
画面ごとのアクセス制御は、`Blocs\Middleware\Role::class` を使用して行います。このミドルウェアは、ルート名とユーザーの「役割（ロール）」を紐づけて、どのユーザーがどの画面にアクセスできるかを制御します。

ルート名が `admin` で始まらない場合、初期状態ではその画面は表示されません。表示させたい場合は、以下のいずれかの対応が必要です。
- 対象ルートのミドルウェアから `Blocs\Middleware\Role::class` を削除する
- `config/role.php` に対象ルートとロールの対応関係を追加する

## 3.2 サイドメニューの設定
管理画面の左側に表示されるサイドメニューは、`config/menu.php` ファイルで定義されています。このファイルでは、メニューのリンク先（ルート名）、表示ラベル（メニュー名）などを設定できます。これにより、ユーザーの種類や権限に応じた柔軟なメニュー構成が可能になります。

# テーブルタイプの入力画面の作り方
複数のレコード（データ）を一括で入力できる画面を「 **テーブルタイプ** の入力画面」と呼びます。大量のデータをまとめて登録したい場合に非常に便利です。たとえば、書籍の一覧や履歴情報など、同じ形式のデータを複数件入力する場面で活用されます。

# ヘルパー関数について
開発を効率化するために、さまざまな便利なヘルパー関数が用意されています。これらの関数を使うことで、メニュー項目の取得やルート・パスの生成など、よく使う処理を簡潔に記述できます。

# ログイン画面の追加方法
Laravelの **Guard** 機能を使うことで、ユーザーの種類に応じた複数のログイン画面を作成できます。例えば、管理者用ログイン画面とメンバー用ログイン画面をそれぞれ分けて用意することで、ユーザーごとに異なる認証処理や画面遷移を実現できます。この仕組みにより、以下のようなことが可能になります。
- 管理者は /login からログインし、管理画面へ遷移
- メンバーは /login2 からログインし、メンバー専用ページへ遷移
- それぞれのログイン・ログアウト処理や認証ルールを分けて管理

# 一覧情報の出力方法
以下の3種類の一覧情報（ルート一覧、バリデーション一覧、データベース定義一覧）をXML形式でダウンロードするには、`route/admin.php` に記述されている該当のルート定義のコメントアウトを解除してください。
```php
/*
Route::get('/route', function () {
  ...
});

Route::get('/validate', function () {
  ...
});

Route::get('/database', function () {
  ...
});
*/
```

コメントアウト解除後に、以下のURLにアクセスすると、それぞれの一覧情報をXML形式で取得できます。
|一覧|URL|
|:-----------|:-----------|
|ルート一覧|/route|
|バリデーション一覧|/validate|
|データベース定義一覧|/database|
