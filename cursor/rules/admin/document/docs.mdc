---
description: docsの使い方
globs: **/*.php
alwaysApply: false
---
# docsの使い方
## 概要
開発におけるドキュメント作成の手間を減らすために、Laravelのコントローラーに処理内容をコメント形式で記述するだけで、Excel形式の処理機能記述書を自動生成できるツールです。コントローラーに処理説明を記述し、画面表示などの実行を行うと、ミドルウェアがその内容を読み取り、Excelドキュメントを自動で生成します。

## ドキュメント生成手順
このツールでは、Laravelのコントローラーに処理説明を記述し、対象ルートにアクセスするだけで、Excel形式の処理機能記述書を自動生成できます。以下の手順で設定・利用します。

### 1. コントローラーに処理説明を書く
**docs()** 関数を使って、処理内容を順番に記述します。記述された順に、ドキュメントに反映されます。
```php
class TestController extends Controller
{
    public function index()
    {
        docs('# 画面表示');
        docs('テンプレートを読み込んで、HTMLを生成');

        return view('welcome');
    }
}
```

### 2. ミドルウェアの設定
ドキュメントを生成したいルートに、`Blocs\Middleware\Docs::class` をミドルウェアとして追加します。
```php
Route::middleware(['web', 'auth', Blocs\Middleware\Role::class, Blocs\Middleware\Docs::class])
    ->prefix('admin/user')
    ->name('admin.user.')
    ->group(function () {
        ...
    }
    );
```

### 3. ドキュメントの生成
設定したルートにアクセスすると、`docs/format.xlsx` をテンプレートとして使用し、`docs` フォルダにExcelドキュメントが生成されます。

- ドキュメントはルートごとに生成されます。
- 出力形式は「IPO（Input: 入力、Process: 処理、Output: 出力）」です。
- システム名・成果物名・作成者は `docs/format.xlsx` を編集して指定します。
- 画面名・メソッド概要は設定ファイルで指定します。
- 作成日・メソッド名は自動で出力されます。

## docsの書き方
このセクションでは、`docs()` 関数の使い方について説明します。処理の見出しや処理内容、入力・出力の記述方法を以下に示します。

### 見出しの書き方
`#` から始めることで、処理の見出しとして扱われます。
```php
docs('# 画面表示');
```

### 処理内容の書き方
`docs()` に引数を1つだけ渡すと、それは処理機能として記録されます。
```php
docs('入力値を以下の条件で検証して、エラーがあればメッセージをセット');
```

複数の処理をまとめて記述したい場合は、配列で渡すことも可能です。
```php
docs([
    '<search>があれば、<'.$this->loopItem.'>のnameを<search>で部分一致検索',
    '<search>があれば、<'.$this->loopItem.'>のemailを<search>で部分一致検索',
    '<search>があれば、<'.$this->loopItem.'>のroleを<search>で部分一致検索',
]);
```

### 入力・出力の書き方
`docs()` に複数の引数を渡すことで、以下のように「入力」「処理」「出力」を記述できます。
- 第1引数：入力（連想配列で指定）
- 第2引数：処理内容（文字列または配列）
- 第3引数：出力（連想配列で指定）

```php
docs(['POST' => '入力値'], '入力値を以下の条件で検証して、エラーがあればメッセージをセット');
```

```php
docs(null, 'エラーがあれば、ログイン画面に戻る', ['FORWARD' => 'admin.user.login']);
```

複数の入力(例：POSTとデータベース)、出力を指定することもできます。

```php
docs(['POST' => '旧パスワード', 'データベース' => 'ユーザー管理'], '<旧パスワード>があれば、<ユーザー管理>をチェック');
```

## 設定ファイルの書き方
設定ファイルでは、キーワードの置換や処理の非表示指定などが行えます。

- `docs/common.php`：すべてのコントローラーに共通する設定を記述します。
- `docs/*Controller.php`：各コントローラー専用の設定ファイルです。メソッド名をキーにして、メソッドごとの設定も可能です。

|設定項目|説明|サンプル|
|---|---|---|
|description|画面名やメソッドの概要を指定|'description' => 'ユーザー管理画面'|
|keyword|テーブル名や項目名などを置換するキーワードを指定|'keyword' => ['name' => '名前']|
|neglect|ドキュメントに出力しない処理を指定|'neglect' => ['<名前>をセッションに保存']|
|comment|処理に対する補足コメントを追加|'comment' => ['<名前>を表示' => 'フリガナも表示']|

###  設定ファイルの記述例
```php
$config = [
    'description' => 'ユーザー管理画面',
    'keyword' => ['name' => '名前'],
    'neglect' => ['<名前>をセッションに保存'],
    'comment' => ['<名前>を表示' => 'フリガナも表示'],
    'index' => [
        'description' => '一覧画面表示',
    ],
];
```

## 回答例
- **user**
artisanコマンドの処理機能記述書を `docs()` を使って自動生成したい。
- **assistant**
artisanコマンドのソースコードに `docs()` 関数を使って説明を記述した後、以下のようにルートを追加することで、ブラウザからアクセスして処理機能記述書を自動生成できます。
- **assistant**
下記のルートにアクセスすると、指定されたartisanコマンド（この例では `summary:hotlog`）が実行され、`Docs` ミドルウェアによってその処理内容が記述書として生成されます。
```php
Route::get('/artisan', function () {
    \Artisan::call('summary:hotlog');
    return 'OK';
})->middleware(Blocs\Middleware\Docs::class);
---
